<!DOCTYPE html>
<html>
<head><title>Control Your Character</title></head>
<body>
<canvas id="game" width="500" height="300" style="border:1px solid black;"></canvas>
<script src="https://interactive-website-9620.onrender.com/socket.io/socket.io.js"></script>
<script>
  const socket = io("https://interactive-website-9620.onrender.com");

  const canvas = document.getElementById('game');
  canvas.setAttribute('tabindex', '0');
  canvas.focus();
  const playObj = canvas.getContext('2d');
  const player = {
    x: 100,
    y: 100,
    width: 20,
    height: 20,
    Yv: 0,
    Xv: 0,
    gravity: 500,
    onGround: false
  };
  let lastTime = performance.now();

  function gameLoop(currentTime) {
    const deltaTime = (currentTime - lastTime)/1000;
    lastTime = currentTime;

    update(deltaTime);
    draw();

    requestAnimationFrame(gameLoop);

  }

  function update(deltaTime) {
    if(!player.onGround) {
          player.Yv += player.gravity*deltaTime;

          player.y += player.Yv *deltaTime;
    }
    if (player.y + player.height >= canvas.height) {
        player.y = canvas.height - player.height;
        player.Yv = 0;
      player.onGround = true;
    }
  }


  function draw() {
    playObj.clearRect(0, 0, canvas.width, canvas.height);
    playObj.fillStyle = 'blue';

    playObj.fillRect(player.x, player.y, player.width, player.height);
    
  }
  
  canvas.addEventListener('keydown', e => {
    if (e.key === "ArrowRight") player.x += 5;
    if (e.key === "ArrowLeft") player.x -= 5;
    if (e.key === "ArrowUp") player.Yv = -500;
    socket.emit("move", { x: player.x , y: player.y , emote: "idle" });
    draw();
  });
  requestAnimationFrame(gameLoop);
</script>
</body>
</html>
